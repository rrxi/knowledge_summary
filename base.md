[toc]



# 计算机网络

## 传输层

### TCP协议

TCP是面向链接的，可靠的传输。TCP通过校验和、序列号、确认应答、重发控制、连接管理以及窗口控制等机制来实现可靠传输。

1. TCP报文

   1. ![image-20200924172302366](/home/ruoran.xi/.config/Typora/typora-user-images/image-20200924172302366.png)
      - 源端口和目的端口，各占2个字节，分别写入源端口和目的端口
      - 序号(seq)：占四个字节， TCP连接中传送字节流中的每个字节都按顺序编号
      - 确认号(ack): 占4个字节，是期望收到对方下一个报文的第一个数据字节的序号
      - 数据偏移：它指出TCP报文的数据距离TCP报文段的起始处有多远
      - 保留，占6位，保留今后使用，但目前应都位0
      - 紧急URG，当URG=1，表明紧急指针字段有效。告诉系统此报文段中有紧急数据
      - 确认ACK，仅当ACK=1时，确认号字段才有效。TCP规定，在连接建立后所有报文的传输都必须把ACK置1
      - 推送PSH，当两个应用进程进行交互式通信时，有时在一端的应用进程希望在键入一个命令后立即就能收到对方的响应，这时候就将PSH=1
      - 复位RST，当RST=1，表明TCP连接中出现严重差错，必须释放连接，然后再重新建立连接
      - 同步SYN，在连接建立时用来同步序号。当SYN=1，ACK=0，表明是连接请求报文，若同意连接，则响应报文中应该使SYN=1，ACK=1
      - 终止FIN，用来释放连接。当FIN=1，表明此报文的发送方的数据已经发送完毕，并且要求释放
      - 窗口，占2字节，指的是通知接收方，发送本报文段的一方的接受窗口（而不是自己的发送窗口）,窗口大小是给对方用的，窗口字段明确指出了现在允许对方发送的数据量。窗口值经常在动态变化
      - 检验和，占2字节，校验首部和数据这两部分
      - 紧急指针，占2字节，指出本报文段中的紧急数据的字节数
      - 选项，长度可变，定义一些其他的可选的参数
      - 填充：为了对齐？

2. 三次握手

   ![image-20200924172728682](/home/ruoran.xi/.config/Typora/typora-user-images/image-20200924172728682.png)

3. 四次挥手

   ![image-20200924172751735](/home/ruoran.xi/.config/Typora/typora-user-images/image-20200924172751735.png)

4. 细节功能

   1. 滑动窗口
   2. 超时重传

# 计算机组成原理

## 字节对齐

### 背景

计算机在访问特定的类型变量时经常在特定的内存地址访问，所以类型数据应该按照一定的规则排列，而不是一个接一个的存储。

合理的内存对齐可以提高访问效率和有效的节省内存空间。

具体使用需要考虑处理器和编译器的类型，GCC中默认4字节对齐。

### 分类和准则

#### 结构体对齐

结构体中的各成员按照声明的顺序在内存中存储，第一个成员的地址和整个结构的地址相同。

1. 对齐准则

   1. 基本概念

      1. 数据类型自身的对齐值：char型数据自身对齐值为1字节，short型数据为2字节，int/float型为4字节，double型为8字节(long要分32位/64位机)
      2.  结构体或类的自身对齐值：其成员中自身对齐值最大的那个值
      3. 指定对齐值：#pragma pack (value)时的指定对齐值value
      4. 数据成员、结构体和类的有效对齐值：自身对齐值和指定对齐值中较小者，即有效对齐值=min{自身对齐值，当前指定的pack值}

      有效对齐值N是最终用来决定数据存放地址方式的值，即该数据的"起始存放地址%N==0"。***结构体的成员变量要对齐存放，结构体本身也要根据自身的有效对齐值圆整(即结构体成员变量占用总长度为结构体有效对齐值的整数倍)*。**

      ```c
      struct B{
          char b;
          int a;
          short c;
      };
      ```

      假设B从0x0000开始存放，指定对齐值默认为4。有效对齐值(b)=min{自身对齐值(b)=1, 指定对齐值=4}=1，且存放地址0x0000符合0x0000%1=0。同理得a[0x0004~0x0007]，c[0x0008~0x0009]，整体[0x0000, 0x0009]=10。

2. 

